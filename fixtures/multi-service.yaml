# Multi-service compose file for e2e testing
# Tests multiple services, build service, and volumes

services:
  frontend:
    image: nginx:alpine
    ports:
      - "80:80"
    labels:
      lissto.dev/expose: "internal"
    volumes:
      - app-data:/usr/share/nginx/html

  backend:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    labels:
      lissto.dev/expose: "none"

  # Build service with repository label - critical for Lissto
  app:
    image: alpine:3.20
    command: ["sh", "-c", "echo 'App running' && sleep infinity"]
    labels:
      lissto.dev/repository: "ghcr.io/lissto-dev/example-app"
      lissto.dev/expose: "none"

# Named volume for pause/resume testing
volumes:
  app-data:
